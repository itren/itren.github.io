---
title: 利用阿里云加速 Hexo 静态博客
categories:
  - 博客
tags:
  - 阿里云
  - Hexo
abbrlink: 67d118b2
date: 2019-12-17 00:00:00
updated: 2019-12-18 00:00:00
---

目前很多静态博客都是使用 Github Pages 来部署的，这个服务对于个人来说非常便捷，不用自己买主机，节省了一笔开销。但因为 Github Pages 的服务在国外，国内访问时延迟很高，如果碰上大事件，说不定就直接禁止访问了。如果希望自己站点的访问速度能快点，可以利用云服务来加速自己的网站，因为普通人的站点访问量不大，所以整体费用并不会很高。当然实现这些优化的前提是需要有自己的域名，否则很多功能都将无法使用。

<!--more-->

## 使用全站加速缓存站点

因为静态站点大部分都是前端资源，所以非常适合做缓存，我目前使用的是阿里云国际提供的全站加速服务。全站加速不仅可以缓存静态资源，对于动态资源还能优化路由，大大提升站点的访问速度。阿里云的全站加速有两种收费方式，一种是流量收费，另外一种是峰值带宽收费，个人站点建议使用流量收费。下面列出阿里云国际站点关于全站加速的收费说明，详情请访问具体[站点](https://www.alibabacloud.com/zh/product/dcdn/pricing?spm=a2c63.p38356.879954.7.319576ad6X5hIH)查看。

![-w1400](https://www.itren.tech/2019/12/21/15768561773030.jpg)

### 1. 申请 SSL 证书

目前国内的阿里云和腾讯云都能申请免费的 SSL 证书，但我的域名是在阿里云国际站点申请的，结果最后发现没有申请免费申请证书的入口，好在后来发现了一个可以申请免费证书的[站点](https://freessl.cn/)。我在这个站点申请的是 TRUSTAsia 证书，这个服务提供商的证书可以提供给两个域名使用，一个是根域名，另外一个是 www 前缀的站点，我申请带两个域名的证书是因为后面的 OSS 自定义域名的时候需要使用。

![-w912](https://www.itren.tech/2019/12/21/15768566532341.jpg)


### 2. 配置 SSL 证书

当我们申请完 SSL 证书之后就可以在全站加速配置我们的域名了。在首页找到全站加速的入口之后点击进入，接着进入域名管理页面。

![-w1680](https://www.itren.tech/2019/12/21/15768569114810.jpg)

点击配置页面之后会进入域名配置页面，接着点击 HTTPS 配置，在该配置页面添加我们证书的公钥和私钥。

![-w1680](https://www.itren.tech/2019/12/21/15768577187705.jpg)
 
配置完证书之后需要配置一下强制跳转，目的是为了我们在浏览器输入网址时直接跳转到 HTTPS 的网址，不需要用户手动输入 HTTPS 前缀。

![-w1678](https://www.itren.tech/2019/12/21/15768588625829.jpg)

TLS 版本我这里全部都勾选了，目前没有问题，但是下面的 HSTS 我尝试开启之后进入循环重定向，目前还不清楚具体的原因，点击什么是 HSTS 也没有说明。后面经过尝试开启 HSTS 之后需要将强制跳转关闭，这样就可以正常访问了。
 
### 3. 配置源站信息

HTTPS 配置完成之后接下来配置我们静态站点的信息，源站信息是用来告诉全站加速我们的资源在什么位置，当我们的站点初次被初次访问或者缓存失效时会去回源。

![-w1678](https://www.itren.tech/2019/12/21/15768582414971.jpg)

因为使用了全站加速之后我们访问站点时会先访问全站加速的服务，所以需要将我们站点的域名承担 CNAME 配置到上面提供的地址，接着配置下面的源站信息。

![-w1680](https://www.itren.tech/2019/12/21/15768583815381.jpg)

域名处添加 Github 给我们提供的二级域名，如果我们在 Github Pages 上面配置了强制 HTTPS，这里就选择 443 端口，如果没有开启可以试试 80 端口。

### 3. 回源配置

回源配置我目前只配置静态协议跟随回源，我配置的协议类型是跟随。因为我自己的域名配置的 HTTPS 访问，而且 Github Pages 配置也是强制 HTTPS，所以协议类型是一样的，没有什么问题。

![-w1680](https://www.itren.tech/2019/12/21/15768598565122.jpg)

上面的配置成功之后基本上就可以正常访问了，如果有问题可以在去阿里云的站点查阅一下资料。后面的配置项是一些优化的功能，可以根据需求选择配置。

### 4. 动静态加速规则

动静态规则加速主要对动态资源和静态资源采用不同的资源进行加速，全站加速是根据文件后缀来区分来写是动态资源，哪些是静态资源。我的站点网页是没有后缀的，所以应该是作为动态资源来加速的，这样我们的网页有变动也不会因为缓存的问题造成内容不一致的问题。但是动态资源全站加速会优化路由，选择一条最近的路来访问我们的页面。

![-w1680](https://www.itren.tech/2019/12/21/15768602492969.jpg)


### 5. 缓存配置

缓存配置主要配置的是静态资源的缓存策略，阿里云也有给出推荐，如果长时间不会变得资源建议配置三个月的时效，经常变动的资源配置十分钟的时效。我将站点的图片、视频、JS 文件都配置的三个月，如果你的站点样式经常变动，可以将 CSS 的时效性配置短一些，我配置的是一分钟，站点重新部署后很快就能生效。当然我们也可以主动给全站加速提交 URL 来强制刷新，如果发现网站长时间没有刷新建议用这个操作一下自己的站点。

![-w1680](https://www.itren.tech/2019/12/21/15768605513292.jpg)

我刷新一般会选择目录，这样目录下面的资源都会被刷新一遍，如果是 URL 刷新的就只有当前 URL 的内容了。

## 使用 OSS 加载图片资源

### 1. 创建 OSS 空间

OSS 的配置还是比较简单的，在对象存储空间点击创建 Bucket 按钮，选择自己想要存储的区域，国际站点需要实名才能选择大陆区域，我没有实名认证，所以选择的是就近的香港地址。

![-w639](https://www.itren.tech/2019/12/21/15768607847617.jpg)

### 2. 绑定用户域名

选择域名管理菜单之后点击绑定用户域名按钮就可以配置了，如果域名是阿里云购买的，会自动帮我们添加域名的 CNAME，我这里使用的 WWW 开头的域名，正好之前的证书可以复用。

![-w1680](https://www.itren.tech/2019/12/21/15768609953374.jpg)

域名添加之后接着添加证书，点击证书托管就可以配置了。

![-w1679](https://www.itren.tech/2019/12/21/15768611024038.jpg)

证书配置后之后开启 CDN 缓存自动刷新缓存，当我们的 OSS 文件发生变化时，CDN 会自动回源。接下来查看一下阿里云 CDN 加速的状态，如果没问题 OSS 的文件就可以使用自定义域名进行访问了。

![-w1680](https://www.itren.tech/2019/12/21/15768613097355.jpg)

这里和之前的全站加速的配置类似，因为本质上都是 CDN，一个用来加载 OSS，一个用来加载外部资源而已。
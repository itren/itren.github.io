name: Blog CI/CD

# è§¦å‘æ¡ä»¶ï¼šåœ¨ push åˆ° hexo-blog-backup åˆ†æ”¯åè§¦å‘
on:
  push:
    branches: 
      - hexo

env:
  TZ: Asia/Shanghai

jobs:
  blog-cicd:
    name: Hexo blog build & deploy
    runs-on: ubuntu-latest # ä½¿ç”¨æœ€æ–°çš„ Ubuntu ç³»ç»Ÿä½œä¸ºç¼–è¯‘éƒ¨ç½²çš„ç¯å¢ƒ

    steps:
    - name: Checkout codes
      uses: actions/checkout@v2
      with:
        submodules: recursive

    - name: Setup node
      # è®¾ç½® node.js ç¯å¢ƒ
      uses: actions/setup-node@v1
      with:
        node-version: '12.x'

    - name: Install hexo dependencies
      # ä¸‹è½½ hexo-cli è„šæ‰‹æ¶åŠç›¸å…³å®‰è£…åŒ…
      run: |
        npm install hexo-cli -g
        npm install
        npm install hexo-deployer-git --save
        
    - name: Change Config
      # æ›¿æ¢ç›¸å…³çš„é…ç½®
      run: |
        git config --global user.name "itrenğŸŒŸactions"
        git config --global user.email "itren.tech@gmail.com"
        sed -i'' "s~https://github.com/itren/itren.github.io.git~https://${{ secrets.GH_ACCESS_TOKEN }}@github.com/itren/itren.github.io.git~" _config.yml
        sed -i'' "s~https://e.coding.net/scdoing/scdoing.coding.me.git~https://${{ secrets.CODING_ACCESS_USER }}:${{ secrets.CODING_ACCESS_TOKEN }}@scdoing.coding.net/scdoing/scdoing.coding.me.git~" _config.yml

    - name: Generate files
      # ç¼–è¯‘é¡¹ç›®
      run: |
        hexo clean
        hexo generate
        
    - name: Deploy files
      # éƒ¨ç½²é¡¹ç›®
      run: |
        hexo deploy
